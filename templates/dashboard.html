{% extends "base.html" %}

{% block body%}

    <div class="row" style="margin-top: 50;">
        <div class="col m3">
            <div class="upload-dashboard" style="padding: 20;">
                <div class="row">
                    <div class="col m6">
                        <div class="white-text left-align" style="font-size: large;">Add Files</div>
                    </div>
                    <div class="col m1 offset-m4">
                        <a href="#"><i class="material-icons small white-text">add_circle_outline</i></a>
                    </div>
                </div>
                <div class="upload-options"></div>
            </div>
        </div>
        <div class="col m9">
            <div  class="file-dashboard" >
                <div class="container">
                    <div class="header white-text" style="margin-top:20; font-size: 80;">Files</div>
                </div>
                <div id="file-list" style="margin: 10 20;">
                    {% set rows = (user_files|length)//3 %}
                    {% for i in range(rows) %}
                    <div class="row"  style="margin: 5px 10px;">
                        {% for j in range(3) %}
                                <div class="col s12 m4">
                                    <div class="card" style="padding: 10;">
                                        <span class="white-text wrap-text" style="font-size: 15px;">{{user_files[(3*i)+j].file_name}}</span>
                                        <section style="margin: 7 3">
                                            <a href="download/{{user_files[(3*i)+j].file_id}}"><i class="small left-align white-text material-icons">file_download</i></a>
                                        </section>
                                    </div>
                                </div>
                        {% endfor %}
                    </div>
                    {% endfor %}
                        
                    <!-- for remaining files -->
                    <div class="row" style="margin: 5 10px;">
                    {% for i in range(3*rows, user_files|length) %}
                        <div class="col s12 m4">
                            <div class="card" style="padding: 10;">
                                <span class="white-text wrap-text" style="font-size: 15px;">{{user_files[i].file_name}}</span>
                                <section style="margin: 7 3">
                                    <a href="download/{{user_files[i].file_id}}"><i class="small left-align white-text material-icons">file_download</i></a>
                                </section>
                            </div>
                        </div>
                    {% endfor %}
                    <!-- <div class="col m3"></div>
                    <div class="col m3"></div>
                    <div class="col m3"></div> -->
                    </div>
                   
                </div>

            </div>
        </div>
    </div>
    <!-- {% if user_files|length %}
        {% for i in user_files %}
        <table class="table">
            <div class="white-text light">{{i}}</div>
        </table>
        {% endfor %}
        {% else %}
        <h1>no files found</h1>
    {% endif %}-->

<h1>Add Your Files</h1>
    <div class="container">
        <form>
            <div class="file-field input-field">
                <div class="btn">
                    <span>File</span>
                    <input type="file"  id="file-input">
                </div>
                <div class="file-path-wrapper">
                    <input class="file-path validate white-text" type="text">
                </div>
            </div>
            </form>
            <button id="upload-button">Upload File</button>
            <div class="container progress">
                <div class="determinate" style="width: 70%"></div>
            </div>
    </div>
    <!-- <div class="white-text d-none">Tushar isnh</div> -->
{% endblock %}

{% block footer %}{% endblock %}

{% block extra_scripts %}

<script>
    $('document').ready(function () {

        $('.progress').hide();

        // triggers when file is selected
        $('#upload-button').click(function() {
            
            console.log("hello i am here");
            let file = $('#file-input')[0].files[0]

            if(file.length==0) {
                alert('Error : No file selected');
                return;
            }
            console.log(file.type)
            const allowed_mime_types = ['text/plain', 'image/jpg', 'image/jpeg'];
            const allowed_size_mb = 2;
        
            if(allowed_mime_types.indexOf(file.type) == -1) {
                alert('Error : Incorrect file type');
                return;
            }

            if(file.size > allowed_size_mb*1024*1024) {
                alert('Error : Exceeded size');
                return;
            }

            // after all validations
            let data = new FormData()
            data.append('file', file, filename=file.name);
            let request = new XMLHttpRequest();
            request.open('POST', '/upload');

            // upload progress event
            request.upload.addEventListener('progress', function(e) {
            let percent_complete = (e.loaded / e.total)*100;
                
                // percentage of upload completed
                $('.determinate').css("width", percent_complete+"%");
            });

            // triggers when file is uploaded completely
            request.addEventListener('load', function(e) {
                request.response;
            });
            //render progress bar
            $('.progress').show();

            // send the data
            request.send(data);
            console.log(request.response)
        });
        
        // adding shadow effect on file-cards on mouse enter
        // $(".file-dashboard .card").mouseenter(function(){
        //     // $(this).addClass("z-depth-5");
        //     // $(this).css("box-shadow","rgb(38, 57, 77) 0px 20px 30px -10px" )
        //     // box-shadow: rgb(38, 57, 77) 0px 20px 30px -10px;
        // });
        
        // // removing shadow effect on file-cards on mouse leave
        // $(".file-dashboard .card").mouseleave(function(){
        //     // $(this).removeClass("z-depth-5");
        //     // $(this).css("box-shadow","" )
        // });
    });
</script>

{% endblock %}